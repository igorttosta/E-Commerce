<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" type="image/png" href="./images/tecnologia.png">
        <title>TechShop</title>

        <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />

        <!-- Link de fontes do cdn CSS  -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

        <link rel="stylesheet" href="style.css">
    </head>

    <body>
    <!-- header section inicio  -->
        <header>

            <a href="#" class="logo">Tech<span>SHOP</span></a>

            <form action="">
                <input type="search" id="search-bar">
                <label for="search-bar" class="fas fa-search"></label>
            </form>

            <div class="icons">
                <div id="theme-toggler" class="fas fa-moon"></div>
                <a id="shopping-cart" class="fas fa-shopping-cart"></a>
                <a id="menu-bar" class="fas fa-user"></a>
            </div>

        </header>
    <!-- header section fim -->
        <div class="filter">
           <ul>
                <li onclick="filtro(0)">Todos</li>
                <li onclick="filtro(1)">Hardware</li>
                <li onclick="filtro(2)">Periféricos</li>
                <li onclick="filtro(3)">Cadeiras</li>
            </ul>
        </div>

    <!-- navbar section  inicio -->
        <nav class="navbar">

            <div id="close" class="fas fa-times"></div>

            <div class="user">
                <img src="images/user.png" alt="">
            </div>

            <div class="links">
                <button id="login"><a href="#home">Logar</a></button>
                <button id="sign-in"><a href="#home">Cadastrar</a></button>
            </div>

        </nav>
    <!-- navbar section  fim -->

    <!-- userIsLogged section  inicio -->
    <nav class="userIsLogged">

        <div id="exit" class="fas fa-times"></div>

        <div class="user">
            <img src="images/user.png" alt="">
            <div>
                <button id="info">Informações</button>
            </div>
            <div>
               <button id="req">Pedidos</button>
            </div>
        </div>

    </nav>
    <!-- userIsLogged section  fim -->

    <!-- Information section  inicio -->
    <nav class="information">

        <div id="sair" class="fas fa-times"></div>

        <div class="user">
            <img src="images/user.png" alt="">
            <div>
                <span>Usuario: </span>
                <p id="user-name"></p>
            </div>
            <div>
                <span>CPF: </span>
                <p id="user-cpf"></p>
                <span>E-mail: </span>
                <p id="user-email"></p>
            </div>
        </div>

        <div class="links">
            <button id="logout"><a href="#home">Sair</a></button>
        </div>

    </nav>
    <!-- Information section  fim -->

    <!-- requests section  inicio -->
    <nav class="requests">

        <div id="sairr" class="fas fa-times"></div>

        <div class="user">
            <img src="images/user.png" alt="">
        </div>
        <div></div>
        <div class="request-items" id="request-item"></div>

    </nav>
    <!-- requests section  fim -->

    <!-- shopping section  inicio -->
        <nav class="shopping">

            <div id="closer" class="fas fa-times"></div>

            <div class="shop" id="shop-container"></div>
            <div class="frete">
                <div class="frete-cart" id="frete-cart">
                    <input class="input" id="subtotal" disabled>
                    <br>
                    <input class="input" id="frete" disabled>
                    <br>
                    <input class="input" id="total" disabled>
                </div>
            </div>
            <div class="links">
                <button><a id="address">Comprar</a></button>
                    <form action="http://localhost:5000/upload" method="post" enctype="multipart/form-data">
                        <input type="file" accept=".csv" name="meucsv" id="meucsv">
                        <input type="submit" value="Inserir CSV">
                    </form>
            </div>

        </nav>
    <!-- shopping section  fim -->

    <!-- shopping section  inicio -->
    <nav class="product-item">
        <div id="back" class="fas fa-times"></div>
        <div id="product-item">

        </div>

    </nav>
<!-- shopping section  fim -->

    <!-- address section  inicio -->
        <nav class="address">

            <div id="exitt" class="fas fa-times"></div>
            <div class="content">
                <div class="links-head">
                    <span>Endereço/Pagamento</span>
                </div>

                <div class="pagamento" id="pagamento">

                </div>

                <div class="links">
                    <label>Pagamento: </label>
                    <br>
                    <input type="radio" id="tipo_pagamento"/>Pix
                    <br>
                    <input type="radio" id="tipo_pagamento"/>Boleto
                    <br>
                    <input type="radio" id="tipo_pagamento"/>Cartão de Crédito
                </div>

                <div class="links-button">
                    <button onclick="deleteAll()"><a>Confirmar</a></button>
                </div>
            </div>
        </nav>
    <!-- address section  fim -->

    <!-- sign-in section  inicio -->
    <nav class="sign-in">

        <div id="closerr" class="fas fa-times"></div>

        <div class="links-head">
            <span>Cadastro</span>
        </div>

        <div class="links">
            <span>Dados do Usuário</span>
            <label>Nome*: </label>
            <input placeholder="João da Silva" id="name" type="text" required maxlength="45" minlength="2">
            <label>CPF*: </label>
            <input placeholder="000.000.000-00" id="cpf" type="text" onkeypress="return event.charCode >= 48 && event.charCode <= 57" required maxlength="14" minlength="11">
            <label>E-mail*: </label>
            <input placeholder="none@gmail.com" id="email" type="email" required maxlength="30">
            <label>Senha*: </label>
            <input placeholder="**********" id="password" type="password" required maxlength="20" minlength="8">
        </div>
        <div class="links">
            <span>Endereço do Usuário</span>
            <label>CEP*: </label>
            <input placeholder="44990-000" id="cep" type="text" onkeypress="return event.charCode >= 48 && event.charCode <= 57" required maxlength="9" minlength="8">
            <label>Estado*: </label>
            <input placeholder="Bahia" id="estado" type="text" required maxlength="20" minlength="2">
            <label>Cidade*: </label>
            <input placeholder="Barra do Mendes" id="cidade" type="text" required>
            <label>Bairro*: </label>
            <input placeholder="Centro" id="bairro" type="text"required>
            <label>Rua*: </label>
            <input placeholder="Rui Barbosa" id="rua" type="text" required>
            <label>Numero*: </label>
            <input placeholder="192" id="numero" type="number">
        </div>

        <div class="links-button">
            <button><a onclick="addUser(
                document.getElementById('name').value,
                document.getElementById('cpf').value,
                document.getElementById('email').value,
                document.getElementById('password').value,
                document.getElementById('cep').value,
                document.getElementById('estado').value,
                document.getElementById('cidade').value,
                document.getElementById('bairro').value,
                document.getElementById('rua').value,
                document.getElementById('numero').value
            )">Cadastrar</a></button>
        </div>

    </nav>
    <!-- sign-in section  fim -->

    <!-- login section  inicio -->
    <nav class="login">

        <div id="closerrr" class="fas fa-times"></div>

        <div class="links-head">
            <span>Tela de Login</span>
        </div>

        <div class="links">
            <label>E-mail: </label>
            <input placeholder="none@gmail.com" id="email2" type="email">
            <label>Senha: </label>
            <input placeholder="**********" id="password2" type="password">
        </div>

        <div class="links">
            <button><a onclick="auth(
                document.getElementById('email2').value,
                document.getElementById('password2').value
            )">Logar</a></button>
        </div>

    </nav>
    <!-- login section  fim -->

    <!-- products section inicio  -->
    <section class="products" id="products">
        <h1 class="heading"> Produtos <span>Recentes</span> </h1>
        <div class="swiper-container product-slider gap">
            <div class="swiper-wrapper" id="teste">
            </div>
        </div>

        <div class="swiper-container product-slider">
            <div class="swiper-wrapper" id="teste">
            </div>
        </div>

    </section>
    <!-- Seção de Produto fim -->

    <!-- footer section inicio  -->

    <section class="footer">

    <div class="footer-container">

        <div class="box-container">

            <div class="box">
                <h3>Entre em contato conosco: </h3>
                <a href="#">+55 (74) 9 9144-9651</a>
                <a href="#">matositosta@gmail.com</a>
                <a href="#">Barra do Mendes - BA</a>
                <img src="images/payment.png" alt="">
            </div>

        </div>

    </div>

    </section>

    <!-- footer section fim -->


    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>

    <!-- import do js -->
    <script src="script.js"></script>

    </body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
    <script type="text/javascript">
        function filtro(id_category = 0) {
            axios.get(`http://localhost:5000/products/${id_category}`)
                .then(response => {
                    document.querySelector('#teste').innerHTML =  response.data.map((item, index) => `
                        <div class="swiper-slide">
                            <div class="slide">
                                <div class="image">
                                    <img src="images/${item.image}" id="image-${index+1}" alt="">
                                </div>
                                <div class="content">
                                    <div class="stars">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star-half-alt"></i>
                                        <span id="reviews-${index+1}"> ${item.review_qtt} Reviews</span>
                                    </div>
                                    <h3 id="name-${index+1}">${item.name}</h3>
                                    <div class="price" id="price-${index+1}">R$ ${item.price} <span> R$ ${item.discount}</span></div>
                                    <div class="button">
                                        <a href="#" class="btn" onclick="addToCart(${item.id})">Add Item</a>
                                        <a class="btn" onclick="openModal(${item.id})">Detalhes</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `)
                })
                .catch(error => console.log(error))
        }

        filtro() //calling when the page render

    let productItem = document.querySelector('.product-item')

    function openModal(id){
    document.getElementById(`btn-${id}`);
    productItem.classList.toggle('active');
    shopping.classList.remove('active');
    userIsLogged.classList.remove('active');
    requests.classList.remove('active');
    information.classList.remove('active');

    axios.get(`http://localhost:5000/product/${id}`)
    .then(response => {
        document.querySelector('#product-item').innerHTML = `
            <div class="product">
                <div class="image">
                    <img src="images/${response.data.image}" alt="">
                </div>
                <div class="stars">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star-half-alt"></i>
                        <span>${response.data.review_qtt} Reviews</span>
                    </div>
                <div class="text">
                    <h1>${response.data.name}</h1>
                    <h2>Valor: R$${response.data.price} <span>  R$${response.data.discount}</span></h2>
                    <div class="description">
                    <h1>Descrição: <br>${response.data.description}</h1>
                    </div>
                    <div class="price" ${response.data.price}> <span> </span></div>
                </div>
                <div class="button">
                    <a href="#" class="btn" onclick="addToCart(${response.data.id})">Add Item</a>
                </div>
            </div>
        `
    })
    .catch(error => console.log(error))
}

    user = JSON.parse(localStorage.getItem('user'));
    let id_user = user.id;
    axios.get(`http://localhost:5000/shopping_cart/${id_user}`)
    .then(response => {
        document.querySelector('#shop-container').innerHTML =  response.data.map((item, index) => `
            <div class="shop-cart">
                <div class="product-cart">
                    <div class="image">
                        <img src="images/${item.image}" id="image-${index+1}" alt="">
                    </div>
                    <div class="text">
                        <p class="span" id="product-name-cart">${item.name}</p>
                        <br>
                        <br>
                        <p class="span" id="product-price-cart">Valor: R$${item.price}</p>
                        <p id="delete" class="fas fa-times" onclick="deleteCartItem(${item.id})"></p>
                    </div>
                </div>
            </div>
            `)
            let valor = 0
            let frete = 30
            for(let i = 0; i < response.data.length; i++) {
                valor += response.data[i].price;
            }
            console.log("TO AQUI")
        let total = valor + frete
        document.getElementById('subtotal').value = `SubTotal: R$${valor.toFixed(2)}`;
        document.getElementById('frete').value = `Frete: R$${frete}`;
        document.getElementById('total').value = `Total: R$${total.toFixed(2)}`;
    })
    .catch(error => console.log(error))

    let address_user = user.fk_address_id;
    axios.get(`http://localhost:5000/address/${address_user}`)
        .then(response => {
            document.querySelector('#pagamento').innerHTML = `
                <div class="text">
                    <h2>Cep: ${response.data.cep}</h2>
                    <h2>Estado: ${response.data.estado}</h2>
                    <h2>Cidade: ${response.data.cidade}</h2>
                    <h2>Bairro: ${response.data.bairro}</h2>
                    <h2>Rua: ${response.data.rua} N°${response.data.numero}</h2>
                </div>
            `
        })
        .catch(error => console.log(error))

    user = JSON.parse(localStorage.getItem('user'));
    document.getElementById('user-name').innerHTML = user.name;
    document.getElementById('user-cpf').innerHTML = user.cpf;
    document.getElementById('user-email').innerHTML = user.email;

    axios.get(`http://localhost:5000/request/${id_user}`)
    .then(response => {
        document.querySelector('#request-item').innerHTML =  response.data.map((item) => `
            <div class="show-request">
                <h2>Pedido de número ${item.id} realizado: ${item.bought_at} no valor de R$${item.total_price}</h2>
            </div>
            `)
    })
    .catch(error => console.log(error))
    </script>
</html>